[pytest]
# =============================================================================
# Pytest Configuration
# Medical Imaging Viewer - Enterprise Security Testing Suite
# ISO 27001 A.14.2.8 - System security testing
# =============================================================================

# Test discovery patterns
python_files = test_*.py
python_classes = Test*
python_functions = test_*

# Test paths
testpaths = tests

# Minimum Python version
minversion = 3.11

# Additional command-line options (can be overridden)
addopts =
    # Verbose output with test names
    -v

    # Show local variables in tracebacks
    -l

    # Show summary of all test outcomes
    -ra

    # Strict markers (fail on unknown markers)
    --strict-markers

    # Strict config (fail on unknown config options)
    --strict-config

    # Show warnings summary
    -W default

    # Coverage configuration (uncomment when ready)
    # --cov=app
    # --cov-report=html
    # --cov-report=term-missing
    # --cov-fail-under=75

    # Hypothesis settings (uncomment when hypothesis installed)
    # --hypothesis-show-statistics

    # Timeout for tests (uncomment when pytest-timeout installed)
    # --timeout=300

# Markers for test categorization
markers =
    security: Security-specific tests (ISO 27001 A.14.2.8)
    authentication: Authentication and authorization tests
    encryption: Cryptography and encryption tests
    rate_limiting: Rate limiting and DoS protection tests
    input_validation: Input validation and sanitization tests
    tls: TLS/SSL enforcement tests
    audit: Audit logging and compliance tests
    integration: Integration and end-to-end tests
    performance: Performance and load tests
    compliance: ISO 27001/HIPAA compliance tests
    fuzzing: Security fuzzing tests with Hypothesis
    property: Property-based tests with Hypothesis
    slow: Tests that take significant time to run (> 1s)
    unit: Unit tests
    cache: Tests requiring Redis cache
    drive: Tests requiring Google Drive API

# Asyncio configuration
asyncio_mode = auto
asyncio_default_fixture_loop_scope = function

# Logging configuration
log_cli = true
log_cli_level = INFO
log_cli_format = %(asctime)s [%(levelname)8s] %(message)s
log_cli_date_format = %Y-%m-%d %H:%M:%S

log_file = logs/pytest.log
log_file_level = DEBUG
log_file_format = %(asctime)s [%(levelname)8s] [%(filename)s:%(lineno)d] %(message)s
log_file_date_format = %Y-%m-%d %H:%M:%S

# Filtering warnings
filterwarnings =
    # Ignore specific warnings (customize as needed)
    ignore::DeprecationWarning
    ignore::PendingDeprecationWarning
    # Uncomment when Hypothesis is installed:
    # ignore::hypothesis.errors.NonInteractiveExampleWarning

# Test collection ignore patterns
norecursedirs =
    .git
    .tox
    .env
    dist
    build
    *.egg
    __pycache__
    .venv
    venv
    node_modules

# Coverage configuration
[coverage:run]
source = app
omit =
    */tests/*
    */migrations/*
    */__pycache__/*
    */site-packages/*
    */venv/*

[coverage:report]
precision = 2
show_missing = True
skip_covered = False

exclude_lines =
    # Exclude abstract methods
    @abstractmethod

    # Exclude debug code
    def __repr__

    # Exclude defensive programming
    raise AssertionError
    raise NotImplementedError

    # Exclude type checking
    if TYPE_CHECKING:
    if typing.TYPE_CHECKING:

    # Exclude main guards
    if __name__ == .__main__.:

[coverage:html]
directory = htmlcov
